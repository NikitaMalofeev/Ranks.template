# ะะพะณะธะบะฐ ัะตะดะธัะตะบัะพะฒ ะธ ะฐะฒัะพัะธะทะฐัะธะธ

## ะกัะตะผะฐ ัะฐะฑะพัั

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    ะะพะปัะทะพะฒะฐัะตะปั ะพัะบััะฒะฐะตั ะฟัะธะปะพะถะตะฝะธะต         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                            โ
                            v
                โโโโโโโโโโโโโโโโโโโโโโโโโ
                โ  Redux Persist        โ
                โ  ะฟัะพะฒะตััะตั localStorageโ
                โโโโโโโโโโโโโฌโโโโโโโโโโโโ
                            โ
                โโโโโโโโโโโโโดโโโโโโโโโโโโ
                โ                       โ
                v                       v
        โโโโโโโโโโโโโโโโ        โโโโโโโโโโโโโโโโ
        โ ะขะพะบะตะฝ ะตััั   โ        โ ะขะพะบะตะฝะฐ ะฝะตั   โ
        โ (user.token) โ        โ (user.token) โ
        โโโโโโโโฌโโโโโโโโ        โโโโโโโโฌโโโโโโโโ
               โ                       โ
               โ                       โ
               v                       v
    โโโโโโโโโโโโโโโโโโโโ     โโโโโโโโโโโโโโโโโโโโ
    โ ะะตัะตัะพะด ะฝะฐ "/"   โ     โ ะะตัะตัะพะด ะฝะฐ "/"   โ
    โโโโโโโโฌโโโโโโโโโโโโ     โโโโโโโโฌโโโโโโโโโโโโ
           โ                         โ
           v                         v
    โโโโโโโโโโโโโโโโโโโโ     โโโโโโโโโโโโโโโโโโโโ
    โ ะะตะดะธัะตะบั ะฝะฐ      โ     โ ะะตะดะธัะตะบั ะฝะฐ      โ
    โ /admin           โ     โ /login           โ
    โโโโโโโโฌโโโโโโโโโโโโ     โโโโโโโโฌโโโโโโโโโโโโ
           โ                         โ
           v                         v
    โโโโโโโโโโโโโโโโโโโโ     โโโโโโโโโโโโโโโโโโโโ
    โ AdminPage        โ     โ LoginPage        โ
    โ (ะทะฐัะธัะตะฝะฐ)       โ     โ (ะฟัะฑะปะธัะฝะฐั)      โ
    โโโโโโโโโโโโโโโโโโโโ     โโโโโโโโฌโโโโโโโโโโโโ
                                    โ
                                    โ ะะฒะพะด ะปะพะณะธะฝะฐ/ะฟะฐัะพะปั
                                    v
                             โโโโโโโโโโโโโโโโโโโโ
                             โ API ะทะฐะฟัะพั       โ
                             โ /admin_login/    โ
                             โโโโโโโโฌโโโโโโโโโโโโ
                                    โ
                        โโโโโโโโโโโโโดโโโโโโโโโโโโ
                        โ                       โ
                        v                       v
                โโโโโโโโโโโโโโโโ        โโโโโโโโโโโโโโโโ
                โ ะฃัะฟะตัะฝะพ      โ        โ ะัะธะฑะบะฐ       โ
                โ (token)      โ        โ (error)      โ
                โโโโโโโโฌโโโโโโโโ        โโโโโโโโฌโโโโโโโโ
                       โ                       โ
                       v                       v
                โโโโโโโโโโโโโโโโ        โโโโโโโโโโโโโโโโ
                โ ะกะพััะฐะฝะธัั ะฒ  โ        โ ะะพะบะฐะทะฐัั     โ
                โ Redux        โ        โ ัะพะพะฑัะตะฝะธะต    โ
                โ Persist      โ        โ ะพะฑ ะพัะธะฑะบะต    โ
                โโโโโโโโฌโโโโโโโโ        โโโโโโโโโโโโโโโโ
                       โ
                       v
                โโโโโโโโโโโโโโโโ
                โ ะะตะดะธัะตะบั ะฝะฐ  โ
                โ /admin       โ
                โโโโโโโโโโโโโโโโ
```

## ะะพะผะฟะพะฝะตะฝัั ัะธััะตะผั ะฐะฒัะพัะธะทะฐัะธะธ

### 1. AppRouter (`src/app/providers/router/ui/AppRouter.tsx`)

ะะปะฐะฒะฝัะน ัะพััะตั ะฟัะธะปะพะถะตะฝะธั, ะฟัะพะฒะตััะตั ะฝะฐะปะธัะธะต ัะพะบะตะฝะฐ:

```typescript
// ะะปะฐะฒะฝะฐั ัััะฐะฝะธัะฐ
<Route
  path="/"
  element={<Navigate to={token ? "/admin" : "/login"} replace />}
/>
```

**ะะพะณะธะบะฐ:**
- ะัะปะธ ัะพะบะตะฝ ะตััั โ ัะตะดะธัะตะบั ะฝะฐ `/admin`
- ะัะปะธ ัะพะบะตะฝะฐ ะฝะตั โ ัะตะดะธัะตะบั ะฝะฐ `/login`

### 2. RequireAuth (`src/app/providers/router/ui/RequireAuth.tsx`)

ะะฐัะธัะฐ ะฟัะธะฒะฐัะฝัั ะผะฐัััััะพะฒ:

```typescript
const RequireAuthRoute = ({ children }) => {
  const token = useSelector((state) => state.user.token);

  if (!token) {
    return <Navigate to="/login" replace />;
  }

  return <>{children}</>;
};
```

**ะะพะณะธะบะฐ:**
- ะัะพะฒะตััะตั ะฝะฐะปะธัะธะต ัะพะบะตะฝะฐ ะฒ Redux
- ะัะปะธ ัะพะบะตะฝะฐ ะฝะตั โ ัะตะดะธัะตะบั ะฝะฐ `/login`
- ะัะปะธ ัะพะบะตะฝ ะตััั โ ัะตะฝะดะตัะธั ะทะฐัะธัะตะฝะฝัะน ะบะพะผะฟะพะฝะตะฝั

### 3. PublicRoute (`src/app/providers/router/ui/PublicRoute.tsx`)

ะะฐัะธัะฐ ะฟัะฑะปะธัะฝัั ะผะฐัััััะพะฒ (ัััะฐะฝะธัะฐ ะปะพะณะธะฝะฐ):

```typescript
const PublicRoute = ({ children }) => {
  const token = useSelector((state) => state.user.token);

  if (token) {
    return <Navigate to="/admin" replace />;
  }

  return <>{children}</>;
};
```

**ะะพะณะธะบะฐ:**
- ะัะพะฒะตััะตั ะฝะฐะปะธัะธะต ัะพะบะตะฝะฐ
- ะัะปะธ ัะพะบะตะฝ ะตััั โ ัะตะดะธัะตะบั ะฝะฐ `/admin`
- ะัะปะธ ัะพะบะตะฝะฐ ะฝะตั โ ะฟะพะบะฐะทัะฒะฐะตั ัััะฐะฝะธัั ะปะพะณะธะฝะฐ

### 4. LoginPage (`src/pages/LoginPage/LoginPage.tsx`)

ะคะพัะผะฐ ะฒัะพะดะฐ:

```typescript
const onFinish = async (values) => {
  try {
    await dispatch(loginThunk(values)).unwrap();
    message.success('ะัะพะด ะฒัะฟะพะปะฝะตะฝ ััะฟะตัะฝะพ!');
    navigate('/admin', { replace: true });
  } catch (err) {
    message.error(err || 'ะัะธะฑะบะฐ ะฒัะพะดะฐ');
  }
};
```

**ะะพะณะธะบะฐ:**
- ะัะฟัะฐะฒะปัะตั ะปะพะณะธะฝ/ะฟะฐัะพะปั ะฝะฐ ัะตัะฒะตั
- ะัะธ ััะฟะตัะต: ัะพััะฐะฝัะตั ัะพะบะตะฝ ะฒ Redux ะธ ะดะตะปะฐะตั ัะตะดะธัะตะบั ะฝะฐ `/admin`
- ะัะธ ะพัะธะฑะบะต: ะฟะพะบะฐะทัะฒะฐะตั ัะพะพะฑัะตะฝะธะต ะพะฑ ะพัะธะฑะบะต

## ะัะธะผะตัั ััะตะฝะฐัะธะตะฒ

### ะกัะตะฝะฐัะธะน 1: ะะตัะฒัะน ะฒัะพะด (ัะพะบะตะฝะฐ ะฝะตั)

1. ะะพะปัะทะพะฒะฐัะตะปั ะพัะบััะฒะฐะตั `http://localhost:5173/`
2. Redux Persist ะฟัะพะฒะตััะตั localStorage โ ัะพะบะตะฝะฐ ะฝะตั
3. AppRouter ัะตะดะธัะตะบัะธั ะฝะฐ `/login`
4. PublicRoute ะฟัะพะฒะตััะตั ัะพะบะตะฝ โ ัะพะบะตะฝะฐ ะฝะตั โ ะฟะพะบะฐะทัะฒะฐะตั LoginPage
5. ะะพะปัะทะพะฒะฐัะตะปั ะฒะฒะพะดะธั ะปะพะณะธะฝ/ะฟะฐัะพะปั ะธ ะฝะฐะถะธะผะฐะตั "ะะพะนัะธ"
6. ะัะฟัะฐะฒะบะฐ ะทะฐะฟัะพัะฐ ะฝะฐ API
7. ะะพะปััะตะฝะธะต ัะพะบะตะฝะฐ
8. ะกะพััะฐะฝะตะฝะธะต ัะพะบะตะฝะฐ ะฒ Redux Persist โ localStorage
9. ะะตะดะธัะตะบั ะฝะฐ `/admin`
10. RequireAuth ะฟัะพะฒะตััะตั ัะพะบะตะฝ โ ัะพะบะตะฝ ะตััั โ ะฟะพะบะฐะทัะฒะฐะตั AdminPage

### ะกัะตะฝะฐัะธะน 2: ะะพะฒัะพัะฝัะน ะฒัะพะด (ัะพะบะตะฝ ะตััั)

1. ะะพะปัะทะพะฒะฐัะตะปั ะพัะบััะฒะฐะตั `http://localhost:5173/`
2. Redux Persist ะฒะพัััะฐะฝะฐะฒะปะธะฒะฐะตั ัะพะบะตะฝ ะธะท localStorage
3. AppRouter ะฟัะพะฒะตััะตั ัะพะบะตะฝ โ ัะพะบะตะฝ ะตััั โ ัะตะดะธัะตะบั ะฝะฐ `/admin`
4. RequireAuth ะฟัะพะฒะตััะตั ัะพะบะตะฝ โ ัะพะบะตะฝ ะตััั โ ะฟะพะบะฐะทัะฒะฐะตั AdminPage

### ะกัะตะฝะฐัะธะน 3: ะะพะฟััะบะฐ ะดะพัััะฟะฐ ะบ /login ั ะฐะบัะธะฒะฝัะผ ัะพะบะตะฝะพะผ

1. ะะพะปัะทะพะฒะฐัะตะปั (ะฐะฒัะพัะธะทะพะฒะฐะฝ) ะฟะตัะตัะพะดะธั ะฝะฐ `/login`
2. PublicRoute ะฟัะพะฒะตััะตั ัะพะบะตะฝ โ ัะพะบะตะฝ ะตััั โ ัะตะดะธัะตะบั ะฝะฐ `/admin`

### ะกัะตะฝะฐัะธะน 4: ะะพะฟััะบะฐ ะดะพัััะฟะฐ ะบ /admin ะฑะตะท ัะพะบะตะฝะฐ

1. ะะพะปัะทะพะฒะฐัะตะปั (ะฝะต ะฐะฒัะพัะธะทะพะฒะฐะฝ) ะฟะตัะตัะพะดะธั ะฝะฐ `/admin`
2. RequireAuth ะฟัะพะฒะตััะตั ัะพะบะตะฝ โ ัะพะบะตะฝะฐ ะฝะตั โ ัะตะดะธัะตะบั ะฝะฐ `/login`

### ะกัะตะฝะฐัะธะน 5: ะััะพะด ะธะท ัะธััะตะผั

1. ะะพะปัะทะพะฒะฐัะตะปั ะฝะฐะถะธะผะฐะตั ะบะฝะพะฟะบั "Logout" ะฒ Header
2. Dispatch ะดะตะนััะฒะธั `logout()`
3. ะัะธััะบะฐ ัะพะบะตะฝะฐ ะธะท Redux
4. ะัะธััะบะฐ localStorage
5. ะะตะดะธัะตะบั ะฝะฐ `/login`

## Redux State

```typescript
interface UserState {
  token: string;              // JWT ัะพะบะตะฝ
  userId: string | null;      // ID ะฟะพะปัะทะพะฒะฐัะตะปั
  isAuthenticated: boolean;   // ะกัะฐััั ะฐะฒัะพัะธะทะฐัะธะธ
  isLoading: boolean;         // ะะฐะณััะทะบะฐ
  error: string | null;       // ะัะธะฑะบะฐ
}
```

## Redux Persist Configuration

```typescript
const persistConfig = {
  key: 'root',
  storage,
  whitelist: ['user', 'menuSettings', 'portfolio', 'tabs'],
};
```

**ะงัะพ ัะพััะฐะฝัะตััั:**
- `user.token` - JWT ัะพะบะตะฝ
- `user.userId` - ID ะฟะพะปัะทะพะฒะฐัะตะปั
- `user.isAuthenticated` - ััะฐััั ะฐะฒัะพัะธะทะฐัะธะธ

**ะงัะพ ะะ ัะพััะฐะฝัะตััั (reset ะฟัะธ ะฟะตัะตะทะฐะณััะทะบะต):**
- `user.isLoading` - ะฒัะตะผะตะฝะฝะพะต ัะพััะพัะฝะธะต
- `user.error` - ะฒัะตะผะตะฝะฝัะต ะพัะธะฑะบะธ

## ะัะพะฒะตัะบะฐ ัะฐะฑะพัั

### 1. ะัะพะฒะตัะบะฐ ะฑะตะท ัะพะบะตะฝะฐ

```bash
# ะัะธััะธัั localStorage
localStorage.clear()

# ะะตัะตะทะฐะณััะทะธัั ัััะฐะฝะธัั
# โ ะะพะปะถะตะฝ ะฟะพะบะฐะทะฐัััั LoginPage
```

### 2. ะัะพะฒะตัะบะฐ ั ัะพะบะตะฝะพะผ

```bash
# ะะพัะปะต ััะฟะตัะฝะพะณะพ ะปะพะณะธะฝะฐ
# โ ะขะพะบะตะฝ ัะพััะฐะฝะตะฝ ะฒ localStorage
# โ ะัะธ ะฟะตัะตะทะฐะณััะทะบะต ัััะฐะฝะธัั ะฟะพะบะฐะทัะฒะฐะตััั AdminPage
```

### 3. ะัะพะฒะตัะบะฐ ะฒััะพะดะฐ

```bash
# ะะฐะถะฐัั ะบะฝะพะฟะบั "Logout"
# โ localStorage ะพัะธัะตะฝ
# โ ะะตะดะธัะตะบั ะฝะฐ LoginPage
```

## ะัะปะฐะดะบะฐ

### ะัะพะฒะตัะบะฐ ัะพะบะตะฝะฐ ะฒ Redux DevTools

```javascript
// ะ Redux DevTools
state.user.token // ะะพะปะถะตะฝ ะฑััั ัััะพะบะพะน ะธะปะธ ะฟัััะพะน ัััะพะบะพะน
state.user.isAuthenticated // true/false
```

### ะัะพะฒะตัะบะฐ ัะพะบะตะฝะฐ ะฒ localStorage

```javascript
// ะ ะบะพะฝัะพะปะธ ะฑัะฐัะทะตัะฐ
localStorage.getItem('persist:root')
// ะะพะปะถะตะฝ ัะพะดะตัะถะฐัั ัะตัะธะฐะปะธะทะพะฒะฐะฝะฝัะน state ั ัะพะบะตะฝะพะผ
```

### ะัะพะฒะตัะบะฐ ะพัะฟัะฐะฒะบะธ ัะพะบะตะฝะฐ ะฒ ะทะฐะฟัะพัะฐั

```javascript
// ะ Network tab DevTools
// ะัะต ะทะฐะฟัะพัั ัะตัะตะท apiClient ะดะพะปะถะฝั ะธะผะตัั ะทะฐะณะพะปะพะฒะพะบ:
Authorization: Bearer <ะฒะฐั_ัะพะบะตะฝ>
```

## API Endpoint

```
POST https://test.webbroker.ranks.pro/main/robo/admin_login/

Request:
{
  "username": "admin",
  "password": "YXL%jhR2|KCVb4@wF7D~TK#7cgbdZ#vZ"
}

Response (ััะฟะตั):
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "userId": "admin-123"
}

Response (ะพัะธะฑะบะฐ):
{
  "message": "Invalid credentials"
}
```

## ะะฐะถะฝัะต ัะฐะนะปั

```
src/
โโโ app/providers/router/ui/
โ   โโโ AppRouter.tsx          # ะะปะฐะฒะฝัะน ัะพััะตั
โ   โโโ RequireAuth.tsx        # ะะฐัะธัะฐ ะฟัะธะฒะฐัะฝัั ะผะฐัััััะพะฒ
โ   โโโ PublicRoute.tsx        # ะะฐัะธัะฐ ะฟัะฑะปะธัะฝัั ะผะฐัััััะพะฒ
โโโ entities/User/
โ   โโโ api/userApi.ts         # API ะทะฐะฟัะพัั
โ   โโโ slice/userSlice.ts     # Redux slice ั loginThunk
โโโ pages/LoginPage/
โ   โโโ LoginPage.tsx          # ะคะพัะผะฐ ะปะพะณะธะฝะฐ
โโโ shared/api/
    โโโ axios.config.ts        # Axios interceptor (ะดะพะฑะฐะฒะปัะตั ัะพะบะตะฝ)
```

## ะะตะทัะผะต

โ **ะขะพะบะตะฝ ะฟัะพะฒะตััะตััั ะฐะฒัะพะผะฐัะธัะตัะบะธ** ะฟัะธ ะทะฐะณััะทะบะต ะฟัะธะปะพะถะตะฝะธั
โ **Redux Persist ัะพััะฐะฝัะตั ัะพะบะตะฝ** ะฒ localStorage
โ **ะะฐัะธัะตะฝั ะฒัะต ะฟัะธะฒะฐัะฝัะต ะผะฐัััััั** ัะตัะตะท RequireAuth
โ **ะัะฑะปะธัะฝัะต ะผะฐัััััั ะฝะตะดะพัััะฟะฝั** ะฐะฒัะพัะธะทะพะฒะฐะฝะฝัะผ ะฟะพะปัะทะพะฒะฐัะตะปัะผ
โ **ะะฒัะพะผะฐัะธัะตัะบะธะน ัะตะดะธัะตะบั** ะฒ ะทะฐะฒะธัะธะผะพััะธ ะพั ะฝะฐะปะธัะธั ัะพะบะตะฝะฐ
โ **ะขะพะบะตะฝ ะฐะฒัะพะผะฐัะธัะตัะบะธ ะดะพะฑะฐะฒะปัะตััั** ะบะพ ะฒัะตะผ API ะทะฐะฟัะพัะฐะผ

ะัะต ัะฐะฑะพัะฐะตั ะฐะฒัะพะผะฐัะธัะตัะบะธ! ๐
